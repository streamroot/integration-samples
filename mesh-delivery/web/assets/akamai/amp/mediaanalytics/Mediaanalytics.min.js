this.akamai=this.akamai||{},this.akamai.amp=this.akamai.amp||{},this.akamai.amp.mediaanalytics=function(e){"use strict";var i=function(e){function i(t,a){var n;return babelHelpers.classCallCheck(this,i),n=e.call(this,t,a)||this,n.sdk=new JS_AkamaiMediaAnalytics(a.config),n.sdk.disableLocation(),a.iplookup===!1&&n.sdk.disableServerIPLookUp(),n.initialized=!1,n}return babelHelpers.inherits(i,e),babelHelpers.createClass(i,[{key:"dimensions",get:function(){return this.getDimensions()},set:function(e){return this.setDimensions(e)}},{key:"setDimensions",value:function(e){return null!=e?this._dimensions=akamai.amp.Utils.override(e,this._dimensions):this._dimensions=this.config.dimensions,this._dimensions}},{key:"getDimensions",value:function(){return this._dimensions||{}}},{key:"addDimensions",value:function(e){var i=this.config.dimensions;for(var t in e){var a=e[t];null!=a&&(i[t]=a)}return this.applyDimensions(i),e}},{key:"applyDimension",value:function(e,i){var t=this.player.evaluateBindings(i);t instanceof Array&&(t=t.toString());try{this.sdk.setData(e,t)}catch(i){this.logger.error('[AMP MEDIA ANALYTICS ERROR]", "Could not set dimension '.concat(e,": ").concat(t),i)}}},{key:"applyDimensions",value:function(e){try{for(var i in e)this.applyDimension(i,e[i])}catch(e){this.logger.error("[AMP MEDIA ANALYTICS ERROR]","Could not set dimensions:",e)}}},{key:"onready",value:function(e){this.dimensions=this.config.dimensions,this.player.addEventListener("adbreakstart",this.onadbreakstart.bind(this)),this.player.addEventListener("adbreakend",this.onadbreakend.bind(this)),this.player.addEventListener("adloaded",this.onadloaded.bind(this)),this.player.addEventListener("adstarted",this.onadstarted.bind(this)),this.player.addEventListener("adended",this.onadended.bind(this)),this.player.addEventListener("adskipped",this.onadbreakskipped.bind(this)),this.player.addEventListener("aderror",this.onaderror.bind(this)),this.player.addEventListener("adfirstquartile",this.onadfirstquartile.bind(this)),this.player.addEventListener("admidpoint",this.onadmidpoint.bind(this)),this.player.addEventListener("adthirdquartile",this.onadthirdquartile.bind(this)),this.player.addEventListener("authorized",this.onauthorized.bind(this))}},{key:"onplayrequest",value:function(e){var i=this;if(0==this.initialized){var t={getStreamHeadPosition:function(){return i.player.currentTime||0}};this.logger.log("[AMP MA EVENT] - handleSessionInit"),this.sdk.handleSessionInit(t),this.initialized=!0}}},{key:"onmediasequenceended",value:function(e){this.logger.log("[AMP MA EVENT] - handlePlayEnd (ended)"),this.sdk.handlePlayEnd()}},{key:"onmediasequenceaborted",value:function(e){this.logger.log("[AMP MA EVENT] - handlePlayEnd (abort)"),this.sdk.handlePlayEnd()}},{key:"onplaying",value:function(e){null!=this.player.ads&&this.player.ads.inProgress||(this.logger.log("[AMP MA EVENT] - handlePlaying"),this.sdk.handlePlaying())}},{key:"onmediachange",value:function(e){var i=e.detail,t=i.isLive?"L":"O",a=i.mediaanalytics||{};this.dimensions=null,this.initialized=!1,this.logger.log("[AMP MA EVENT] - setStreamURL",i.src),this.sdk.setStreamURL(i.src,!1);var n=this.config.viewerId||this.config.viewerID||this.config["std:viewerId"];null!=n&&this.sdk.setViewerId(n),this.dimensions=akamai.amp.Utils.override(a,{deliveryType:t}),this.applyDimensions(this.dimensions)}},{key:"ondurationchange",value:function(e){var i=e.detail?e.detail.toFixed():0;this.dimensions={contentLength:i},this.applyDimensions(this.dimensions),this.logger.log("[AMP MA EVENT] - setStreamDuration",e.detail),this.sdk.setStreamDuration(e.detail)}},{key:"updateMedia",value:function(e){this.logger.log("[AMP MA EVENT] - handleTitleSwitch"),this.sdk.handleTitleSwitch(e)}},{key:"onfragmentloadstart",value:function(e){"function"==typeof fragmentDownloadStarted&&fragmentDownloadStarted(e.detail)}},{key:"onauthorized",value:function(e){var i=e.detail,t={};i.viewerId&&(t.viewerId=i.viewerId,t["std:viewerId"]=i.viewerId),i.idps&&i.idps.name&&(t.mvpdName=i.idps.name),Object.values(t).some(function(e){return null!=e})&&this.addDimensions(t)}},{key:"onadbreakstart",value:function(){this.player.mediaElement.dataset.isad=!0}},{key:"onadbreakend",value:function(){this.player.mediaElement.dataset.isad=!1}},{key:"onadloaded",value:function(e){try{var i=e.data,t={adTitle:i.title,adDuration:i.duration,adPartnerId:i.partner,adId:i.id};this.logger.log("[AMP MA EVENT] - handleAdLoaded"),this.sdk.handleAdLoaded(t)}catch(e){this.logger.error("[AMP MEDIA ANALYTICS ERROR]",e)}}},{key:"onadstarted",value:function(){this.logger.log("[AMP MA EVENT] - handleAdStarted"),this.sdk.handleAdStarted()}},{key:"onadbreakskipped",value:function(){this.logger.log("[AMP MA EVENT] - handleAdSkipped"),this.sdk.handleAdSkipped()}},{key:"onaderror",value:function(e){this.logger.log("[AMP MA EVENT] - handleAdError"),this.sdk.handleAdError(e)}},{key:"onadfirstquartile",value:function(){this.logger.log("[AMP MA EVENT] - handleAdFirstQuartile"),this.sdk.handleAdFirstQuartile()}},{key:"onadmidpoint",value:function(){this.logger.log("[AMP MA EVENT] - handleAdMidPoint"),this.sdk.handleAdMidPoint()}},{key:"onadthirdquartile",value:function(){this.logger.log("[AMP MA EVENT] - handleAdThirdQuartile"),this.sdk.handleAdThirdQuartile()}},{key:"onadended",value:function(){this.logger.log("[AMP MA EVENT] - handleAdComplete"),this.sdk.handleAdComplete()}},{key:"onpause",value:function(){this.logger.log("[AMP MA EVENT] - handlePause"),this.sdk.handlePause()}},{key:"onseeking",value:function(){(this.player.currentTime>.1||0===this.player.currentTime)&&(this.sdk.handleSeekStart(),this.logger.log("[AMP MA EVENT] - handleSeekStart"))}},{key:"onseeked",value:function(){(this.player.currentTime>.1||0===this.player.currentTime)&&(this.sdk.handleSeekEnd(),this.logger.log("[AMP MA EVENT] - handleSeekEnd"))}},{key:"onerror",value:function(e){var i=e.detail||{},t=i.message||i.toString();this.logger.log("[AMP MA EVENT] - handleError",t),this.sdk.handleError(t)}},{key:"onbufferingchange",value:function(e){this.logger.log("[AMP MA EVENT] - handleBufferStart",e.detail),e.detail===!0?this.sdk.handleBufferStart():this.sdk.handleBufferEnd()}},{key:"onqualitychange",value:function(e){this.logger.log("[AMP MA EVENT] - handleBitRateSwitch",e.data.bitrate),this.sdk.handleBitRateSwitch(e.data.bitrate)}}]),i}(akamai.amp.Plugin);return akamai.amp.AMP.registerPlugin("mediaanalytics",akamai.amp.Plugin.createFactory(i)),e.MediaAnalytics=i,Object.defineProperty(e,"__esModule",{value:!0}),e}({});