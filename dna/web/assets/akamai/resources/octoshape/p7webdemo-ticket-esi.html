<esi:comment text="-------------------------------------------------------"/><esi:comment text=" This HTML/ESI code shall write the MD5 hash to STDOUT "/><esi:comment text="-------------------------------------------------------"/><esi:comment text=" OctoshapeAuthid can be handed over as REST parameter and shall contain the unique client ID "/><esi:comment text=" OctoshapeFilter can be handed over as REST parameter and shall contain the filter information "/><esi:comment text=" Usage: HTTP://host/path?OctoshapeAuthid=lsjsigiowo&OctoshapeFilter=/customer/name "/><esi:comment text="--------------------------------------------------------------------------------------------------"/><esi:comment text=" PARAMETER SETTINGS "/><esi:assign name="password" value="WVdiisd23bnirSd" /><esi:comment text=" Token Auth password for the stream "/><esi:assign name="useauthid" value="0" /><esi:comment text=" 1 = TRUE:uses client ID to generate a worldwide unique hash; 0 = FALSE: hash is stream specific only "/><esi:assign name="usefilter" value="0" /><esi:comment text=" 1 = TRUE: uses filter to generate hash for a stream bundle; 0 = FALSE: hash is single stream "/><esi:assign name="hardexpire" value="30" /><esi:comment text=" X = disconnect user after X seconds, or set to 0=FALSE to disable "/><esi:assign name="unique" value="''" /><esi:comment text=" set a, per user, unique string here, or set to an empty stream to disable unique tickets "/><esi:comment text=" CONSTANT SETTINGS - DO NOT CHANGE "/><esi:assign name="algoid" value="1" /><esi:comment text=" only standard HMAC hash possible 128 bit "/><esi:assign name="authid" value="$(QUERY_STRING{'OctoshapeAuthid'})" /><esi:assign name="filter" value="$(QUERY_STRING{'OctoshapeFilter'})" /><esi:comment text=" END of PARAMETER SETTINGS "/><esi:comment text="--------------------------------------------------------------------------------------------------"/><esi:comment text=" Build hash string in authhash and information in authinfo "/><esi:choose><esi:when test="$(useauthid)"><esi:choose><esi:when test="$(authid)"><esi:assign name="authid" value="$(authid) + ','" /><esi:assign name="authinfo" value="''" /></esi:when><esi:otherwise><esi:assign name="authhash" value="'ERROR_NO_AUTHID '" /><esi:assign name="authinfo" value="' '" /></esi:otherwise></esi:choose></esi:when><esi:otherwise><esi:assign name="authid" value="''" /><esi:assign name="authinfo" value="'useauthid=false,'" /></esi:otherwise></esi:choose><esi:choose><esi:when test="$(unique)"><esi:assign name="authinfo" value="$(authinfo) + 'unique=' + $(unique) + ','" /></esi:when></esi:choose><esi:choose><esi:when test="$(usefilter)"><esi:choose><esi:when test="$(filter)"><esi:assign name="authinfo" value="$(authinfo) + 'filter=' + $(filter) + ','" /></esi:when><esi:otherwise><esi:assign name="authhash" value="'ERROR_NO_FILTER '" /></esi:otherwise></esi:choose></esi:when></esi:choose><esi:choose><esi:when test="$(hardexpire)"><esi:assign name="authinfo" value="$(authinfo) + 'hardexpire=' + $str($time()+$(hardexpire)) + '000,'" /><esi:assign name="playerticketrefresh" value="'playerticketrefresh=' + $str($(hardexpire))" /></esi:when><esi:otherwise><esi:assign name="playerticketrefresh" value="''" /></esi:otherwise></esi:choose><esi:assign name="authinfo" value="$substr( $(authinfo), 0, -1 )" /><esi:comment text=" authinfo w/o trailing comma "/><esi:assign name="authhashstring" value="$(password) + ',' + $(authid) + $(authinfo)" /><esi:comment text=" build the hash string "/><esi:choose><esi:when test="!$(authhash)"><esi:assign name="authhash" value="$digest_md5_hex($(authhashstring))" /></esi:when></esi:choose><esi:vars>$(authhash)
$(authinfo)
$(playerticketrefresh)</esi:vars>