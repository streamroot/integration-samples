{"version":3,"file":"Eventmanagement.js","sources":["../../../../src/EventManagement.js","../../../../src/main.js"],"sourcesContent":["export default class EventManagement extends akamai.amp.Plugin {\n\n  constructor(player, config) {\n    super(player, config)\n\n    this.poller = new akamai.amp.Poller()\n    this.poller.ondatachange = (event) => {\n      const id = (event.detail || \"\").trim()\n      let state = null\n\n      if (id == EventManagement.ON) {\n        state = {id: EventManagement.ON}\n      }\n      else {\n        const states = this.states\n        for (let i = 0, len = this.states.length; i < len; i++) {\n          if (states[i].id == id) {\n            state = states[i]\n            break\n          }\n        }\n      }\n\n      if (state != null) {\n        this.state = state\n      }\n    }\n\n    this.states = config.states || []\n    this._state = {}\n    this.url = config.url\n    this.interval = config.interval || 5\n    this.poster = document.createElement(\"img\")\n    this.poster.className = \"amp-event-poster\"\n\n    this.transform = this.transform.bind(this)\n    player.addTransform(akamai.amp.TransformType.MEDIA, this.transform)\n  }\n\n  static get ON() {\n    return \"on\"\n  }\n\n  static get STATE_CHANGE() {\n    return \"statechange\"\n  }\n\n  transform(media) {\n    return new Promise((resolve, reject) => {\n      if (this.state.id === EventManagement.ON) {\n        resolve(media)\n        return\n      }\n\n      const stateChange = (event) => {\n        if (event.detail.id == EventManagement.ON) {\n          this.removeEventListener(EventManagement.STATE_CHANGE, stateChange)\n          resolve(media)\n        }\n      }\n\n      this.addEventListener(EventManagement.STATE_CHANGE, stateChange)\n    })\n  }\n\n  set url(value) {\n    this.poller.url = value\n  }\n\n  get url() {\n    return this.poller.url\n  }\n\n  get interval() {\n    return this.poller.interval / 1000\n  }\n\n  set interval(value) {\n    this.poller.interval = value * 1000\n  }\n\n  set state(value) {\n    if (this._state == value)\n      return\n\n    this._state = value\n    this.dispatchEvent(new akamai.amp.Event(EventManagement.STATE_CHANGE, value))\n\n    switch (this._state.id) {\n      case \"on\":\n        if (this.player.container.contains(this.poster)) {\n          this.player.container.removeChild(this.poster)\n        }\n        if (this.player.autoplay === true)\n          this.player.play()\n      break\n\n      default:\n        if (this._state.poster != null) {\n          this.poster.src = this._state.poster\n          this.player.container.appendChild(this.poster)\n        }\n        this.player.pause()\n        this.player.displayState = akamai.amp.DisplayState.NORMAL\n      break\n    }\n  }\n\n  get state() {\n    return this._state\n  }\n\n  onready() {\n    this.poller.start()\n  }\n}\n","import \"./EventManagement.less\"\nimport EventManagement from \"./EventManagement.js\"\n\nakamai.amp.AMP.registerPlugin(\"eventmanagement\", akamai.amp.Plugin.createFactory(EventManagement))\n\nexport {EventManagement}\n"],"names":["EventManagement","player","config","poller","akamai","amp","Poller","ondatachange","event","id","detail","trim","state","ON","states","i","len","length","_state","url","interval","poster","document","createElement","className","transform","bind","addTransform","TransformType","MEDIA","media","Promise","resolve","reject","stateChange","removeEventListener","STATE_CHANGE","addEventListener","start","value","dispatchEvent","Event","container","contains","removeChild","autoplay","play","src","appendChild","pause","displayState","DisplayState","NORMAL","Plugin","AMP","registerPlugin","createFactory"],"mappings":";;;;;IAAqBA;;;2BAEPC,MAAZ,EAAoBC,MAApB,EAA4B;;;8IACpBD,MADoB,EACZC,MADY;;UAGrBC,MAAL,GAAc,IAAIC,OAAOC,GAAP,CAAWC,MAAf,EAAd;UACKH,MAAL,CAAYI,YAAZ,GAA2B,UAACC,KAAD,EAAW;UAC9BC,KAAK,CAACD,MAAME,MAAN,IAAgB,EAAjB,EAAqBC,IAArB,EAAX;UACIC,QAAQ,IAAZ;;UAEIH,MAAMT,gBAAgBa,EAA1B,EAA8B;gBACpB,EAACJ,IAAIT,gBAAgBa,EAArB,EAAR;OADF,MAGK;YACGC,SAAS,MAAKA,MAApB;aACK,IAAIC,IAAI,CAAR,EAAWC,MAAM,MAAKF,MAAL,CAAYG,MAAlC,EAA0CF,IAAIC,GAA9C,EAAmDD,GAAnD,EAAwD;cAClDD,OAAOC,CAAP,EAAUN,EAAV,IAAgBA,EAApB,EAAwB;oBACdK,OAAOC,CAAP,CAAR;;;;;;UAMFH,SAAS,IAAb,EAAmB;cACZA,KAAL,GAAaA,KAAb;;KAlBJ;;UAsBKE,MAAL,GAAcZ,OAAOY,MAAP,IAAiB,EAA/B;UACKI,MAAL,GAAc,EAAd;UACKC,GAAL,GAAWjB,OAAOiB,GAAlB;UACKC,QAAL,GAAgBlB,OAAOkB,QAAP,IAAmB,CAAnC;UACKC,MAAL,GAAcC,SAASC,aAAT,CAAuB,KAAvB,CAAd;UACKF,MAAL,CAAYG,SAAZ,GAAwB,kBAAxB;;UAEKC,SAAL,GAAiB,MAAKA,SAAL,CAAeC,IAAf,OAAjB;WACOC,YAAP,CAAoBvB,OAAOC,GAAP,CAAWuB,aAAX,CAAyBC,KAA7C,EAAoD,MAAKJ,SAAzD;;;;;;8BAWQK,OAAO;;;aACR,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;YAClC,OAAKrB,KAAL,CAAWH,EAAX,KAAkBT,gBAAgBa,EAAtC,EAA0C;kBAChCiB,KAAR;;;;YAIII,cAAc,SAAdA,WAAc,CAAC1B,KAAD,EAAW;cACzBA,MAAME,MAAN,CAAaD,EAAb,IAAmBT,gBAAgBa,EAAvC,EAA2C;mBACpCsB,mBAAL,CAAyBnC,gBAAgBoC,YAAzC,EAAuDF,WAAvD;oBACQJ,KAAR;;SAHJ;;eAOKO,gBAAL,CAAsBrC,gBAAgBoC,YAAtC,EAAoDF,WAApD;OAbK,CAAP;;;;8BAgEQ;WACH/B,MAAL,CAAYmC,KAAZ;;;;sBAhDMC,OAAO;WACRpC,MAAL,CAAYgB,GAAZ,GAAkBoB,KAAlB;;wBAGQ;aACD,KAAKpC,MAAL,CAAYgB,GAAnB;;;;wBAGa;aACN,KAAKhB,MAAL,CAAYiB,QAAZ,GAAuB,IAA9B;;sBAGWmB,OAAO;WACbpC,MAAL,CAAYiB,QAAZ,GAAuBmB,QAAQ,IAA/B;;;;sBAGQA,OAAO;UACX,KAAKrB,MAAL,IAAeqB,KAAnB,EACE;;WAEGrB,MAAL,GAAcqB,KAAd;WACKC,aAAL,CAAmB,IAAIpC,OAAOC,GAAP,CAAWoC,KAAf,CAAqBzC,gBAAgBoC,YAArC,EAAmDG,KAAnD,CAAnB;;cAEQ,KAAKrB,MAAL,CAAYT,EAApB;aACO,IAAL;cACM,KAAKR,MAAL,CAAYyC,SAAZ,CAAsBC,QAAtB,CAA+B,KAAKtB,MAApC,CAAJ,EAAiD;iBAC1CpB,MAAL,CAAYyC,SAAZ,CAAsBE,WAAtB,CAAkC,KAAKvB,MAAvC;;cAEE,KAAKpB,MAAL,CAAY4C,QAAZ,KAAyB,IAA7B,EACE,KAAK5C,MAAL,CAAY6C,IAAZ;;;;cAIE,KAAK5B,MAAL,CAAYG,MAAZ,IAAsB,IAA1B,EAAgC;iBACzBA,MAAL,CAAY0B,GAAZ,GAAkB,KAAK7B,MAAL,CAAYG,MAA9B;iBACKpB,MAAL,CAAYyC,SAAZ,CAAsBM,WAAtB,CAAkC,KAAK3B,MAAvC;;eAEGpB,MAAL,CAAYgD,KAAZ;eACKhD,MAAL,CAAYiD,YAAZ,GAA2B9C,OAAOC,GAAP,CAAW8C,YAAX,CAAwBC,MAAnD;;;;wBAKM;aACH,KAAKlC,MAAZ;;;;wBAtEc;aACP,IAAP;;;;wBAGwB;aACjB,aAAP;;;;EA5CyCd,OAAOC,GAAP,CAAWgD;;ACGxDjD,OAAOC,GAAP,CAAWiD,GAAX,CAAeC,cAAf,CAA8B,iBAA9B,EAAiDnD,OAAOC,GAAP,CAAWgD,MAAX,CAAkBG,aAAlB,CAAgCxD,iBAAhC,CAAjD,EAEA;;;;"}