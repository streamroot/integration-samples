!function(e){"use strict";var t=function(){function e(){babelHelpers.classCallCheck(this,e)}return babelHelpers.createClass(e,null,[{key:"ID",get:function(){return"chromecast"}},{key:"CHANNEL_ID",get:function(){return"urn:x-cast:com.akamai.amp.cast"}},{key:"APPLICATION_ID",get:function(){return"CC1AD845"}},{key:"SUPPORTED_TYPES",get:function(){return[akamai.amp.Utils.mimeTypes.m3u8,akamai.amp.Utils.mimeTypes.mp4,akamai.amp.Utils.mimeTypes.mpd,akamai.amp.Utils.mimeTypes.ism,akamai.amp.Utils.mimeTypes.webm,akamai.amp.Utils.mimeTypes.mp3]}}]),e}(),a=function(e){function t(e){babelHelpers.classCallCheck(this,t);var a=babelHelpers.possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return a.player=e.player,a.plugin=e.plugin,a._hidden=a.player.captioning.hidden,a._tracks=[],a.onEditTracksInfoSuccess=a.onEditTracksInfoSuccess.bind(a),a.onEditTracksInfoError=a.onEditTracksInfoError.bind(a),a.autoSelectTrack(),a.hidden=a.player.hidden,a}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"onEditTracksInfoSuccess",value:function(e){}},{key:"onEditTracksInfoError",value:function(e){}},{key:"selectTrackByLanguage",value:function(e){var t=this.tracks.filter(function(t){return t.language===e})[0];return null!=t&&(this.track=t),t}},{key:"changeSettings",value:function(e){}},{key:"autoSelectTrack",value:function(){var e=this.player.language,t=null;return null!=e&&(e=e.split("-").shift(),t=this.selectTrackByLanguage(e)),t}},{key:"tracks",get:function(){var e=this.plugin.mediaSession;return null==e||null==e.media||null==e.media.tracks?[]:e.media.tracks.filter(function(e){return e.subtype==chrome.cast.media.TextTrackType.CAPTIONS?e:null})}},{key:"track",get:function(){return this._track||{}},set:function(e){this._track=e}},{key:"hidden",get:function(){return this._hidden},set:function(e){if(e!=this._hidden){this._hidden=e;var t=e?[]:[this.track.trackId],a=new chrome.cast.media.EditTracksInfoRequest(t);this.plugin.mediaSession.editTracksInfo(a,this.onEditTracksInfoSuccess,this.onEditTracksInfoError),this.dispatch("visibilitychange",!this._hidden)}}}]),t}(akamai.amp.EventDispatcher),i=function(e){function t(e){babelHelpers.classCallCheck(this,t);var a=babelHelpers.possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return cast.framework.setLoggerLevel(e.debug?cast.framework.LoggerLevel.DEBUG:cast.framework.LoggerLevel.NONE),a.player=e.player,a.config=akamai.amp.Utils.clone(a.player.config),a.plugin=e,a.state={playState:akamai.amp.PlayState.READY,waiting:!1,seeking:!1},a.onRemotePlayerChange=a.onRemotePlayerChange.bind(a),a.onMediaSession=a.onMediaSession.bind(a),a.onMediaSession(),a.plugin.castSession.addEventListener(cast.framework.SessionEventType.MEDIA_SESSION,a.onMediaSession),a.createElements(),a.loadPlugins().then(function(){a.dispatch(akamai.amp.Events.READY),a.dispatch(akamai.amp.Events.MEDIA_CHANGE,a.media),a.dispatch(akamai.amp.Events.CAN_PLAY_THROUGH)}),a}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"createElements",value:function(){this.container=document.createElement("div"),this.container.className="amp-chromecast-sender",this.player.container.appendChild(this.container),this.message=document.createElement("div"),this.message.className="amp-chromecast-sender-msg";var e=document.createElement("div");e.className="amp-chromecast-sender-text",e.innerHTML=this.getLocalizedString("MSG_CHROMECAST_MESSAGE",{device:this.plugin.castSession.getCastDevice().friendlyName}),this.message.appendChild(e),this.player.container.appendChild(this.message)}},{key:"loadPlugins",value:function(){var e=this;this.chromecast={available:!0,launch:function(){return e.plugin.launch()}},null!=this.player.captioning&&(this.captioning=new a(this)),this.localization={getLanguageString:function(t){return e.player.localization.getLanguageString(t)},getString:function(t){return e.player.localization.getString(t)}};var t=this.player.mode,i="react",s=akamai.amp.AMP.plugins[i][t],n=this.config.plugins.react;if(n.mode=akamai.amp.react.Mode.PERSISTENT,null==s)throw new Error("[AMP] Plugin could not be found: "+i);return s(this,n,i).then(function(t){e[i]=t,null!=t.feature&&(e[t.feature]=t),t.container.classList.add("amp-remote-playback"),e.logger.log("[AMP] Plugin registered: "+i)}).catch(function(t){return e.logger.error(t)})}},{key:"onRemotePlayerChange",value:function(e){this.logger.log("[AMP CHROMECAST EVENT]",e.field,e.value);var t=(cast.framework.RemotePlayerEventType,akamai.amp.Events),a=e.value;switch(e.field){case"mediaInfo":if(null==this.state.media&&null!=a){if(this.state.media=a,this.playState=this.remotePlayer.playerState.toLowerCase(),this.dispatch(akamai.amp.Events.DURATION_CHANGE,a.duration),a.customData&&a.customData.media){var i=a.customData.media;this.dispatch(akamai.amp.Events.TEMPORAL_TYPE_CHANGE,i.temporalType),this.dispatch(akamai.amp.Events.IS_LIVE,i.isLive)}this.dispatch(akamai.amp.Events.MEDIA_CHANGE,a)}else null==a&&(this.state.media=null);break;case"isMediaLoaded":a===!1&&(this.playState=akamai.amp.PlayState.ENDED);break;case"currentTime":this.seeking===!0&&(this.dispatch(akamai.amp.Events.CAN_PLAY_THROUGH),this.dispatch(akamai.amp.Events.SEEKED),this.state.seeking=!1),this.waiting===!0&&(this.waiting=!1),this.dispatch(t.TIME_UPDATE,this.currentTime);break;case"duration":this.dispatch(t.DURATION_CHANGE,this.duration);break;case"volumeLevel":this.dispatch(t.VOLUME_CHANGE,this.volume);break;case"isMuted":this.dispatch(t.VOLUME_CHANGE,a?0:this.volume),this.dispatch(t.MUTE_CHANGE,this.muted);break;case"playerState":var s=null;switch(a){case chrome.cast.media.PlayerState.PLAYING:s=akamai.amp.PlayState.PLAYING;break;case chrome.cast.media.PlayerState.PAUSED:s=akamai.amp.PlayState.PAUSED;break;case chrome.cast.media.PlayerState.BUFFERING:this.waiting=!0}s&&(this.playState=s)}this.dispatch(e)}},{key:"onMediaSession",value:function(e){this.logger.log("[AMP CHROMECAST EVENT]",e),null!=this.remotePlayerController&&this.remotePlayerController.removeEventListener(cast.framework.RemotePlayerEventType.ANY_CHANGE,this.onRemotePlayerChange),this.remotePlayer=new cast.framework.RemotePlayer,this.remotePlayerController=new cast.framework.RemotePlayerController(this.remotePlayer),this.remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.ANY_CHANGE,this.onRemotePlayerChange),this.dispatch(e)}},{key:"evaluateBindings",value:function(e,t){var a={media:this.media,player:{mode:"html5"},now:Date.now()};return akamai.amp.DataBinding.evaluateBindings(e,akamai.amp.Utils.override(a,t))}},{key:"play",value:function(){this.remotePlayerController.playOrPause()}},{key:"pause",value:function(){this.remotePlayerController.playOrPause()}},{key:"goLive",value:function(){}},{key:"getLocalizedString",value:function(e,t){return this.player.getLocalizedString(e,t)}},{key:"destroy",value:function(){null!=this.remotePlayerController&&this.remotePlayerController.removeEventListener(cast.framework.RemotePlayerEventType.ANY_CHANGE,this.onRemotePlayerChange),this.plugin.castSession.removeEventListener(cast.framework.SessionEventType.MEDIA_SESSION,this.onMediaSession),this.player.container.removeChild(this.container),this.player.container.removeChild(this.message)}},{key:"mediaElement",get:function(){return{}}},{key:"logger",get:function(){return this.plugin.logger}},{key:"currentTime",set:function(e){e!=this.state.currentTime&&(this.state.seeking=!0,this.state.currentTime=e,this.remotePlayer.currentTime=e,this.paused===!1&&this.dispatch(akamai.amp.Events.SEEKING),this.remotePlayerController.seek())},get:function(){return this.remotePlayer.currentTime}},{key:"duration",get:function(){return this.remotePlayer.duration}},{key:"autoplay",set:function(e){},get:function(){return!0}},{key:"media",set:function(e){this.plugin.load(this.player.defaultMediaTransform(e))},get:function(){var e=this.plugin.mediaSession;return null!=e&&null!=e.media.customData?e.media.customData.media:this.player.media}},{key:"volume",set:function(e){this.remotePlayer.volumeLevel=e,this.remotePlayerController.setVolumeLevel()},get:function(){return this.remotePlayer.volumeLevel}},{key:"muted",set:function(e){this.remotePlayerController.muteOrUnmute()},get:function(){return this.remotePlayer.isMuted}},{key:"playbackRate",set:function(e){},get:function(){return 1}},{key:"waiting",set:function(e){e!=this.state.waiting&&(this.state.waiting=e,e&&this.dispatch(akamai.amp.Events.WAITING))},get:function(){return this.state.waiting}},{key:"seeking",get:function(){return this.state.seeking}},{key:"paused",get:function(){return this.remotePlayer.isPaused}},{key:"ended",get:function(){return!1}},{key:"quality",set:function(e){},get:function(){return 0}},{key:"qualityMode",get:function(){return"auto"}},{key:"qualityLevels",get:function(){return[]}},{key:"audioTracks",get:function(){return[]}},{key:"playState",set:function(e){var t=this.state.playState;if(e!=t)switch(this.state.playState=e,this.dispatch(akamai.amp.Events.PLAY_STATE_CHANGE,{previous:t,value:e}),e){case akamai.amp.PlayState.PLAYING:this.dispatch(akamai.amp.Events.PLAYING);break;case akamai.amp.PlayState.PAUSED:this.dispatch(akamai.amp.Events.PAUSE);break;case akamai.amp.PlayState.ENDED:this.dispatch(akamai.amp.Events.ENDED)}},get:function(){return this.state.playState}},{key:"viewComponent",get:function(){return this.container}},{key:"settings",get:function(){return this.player.settings}}]),t}(akamai.amp.EventDispatcher),s=function(e){function a(e,t){babelHelpers.classCallCheck(this,a);var i=babelHelpers.possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e,t));return i._available=!1,i}return babelHelpers.inherits(a,e),babelHelpers.createClass(a,[{key:"onready",value:function(){this.bindHandlers(["onCastApiAvailable","onCastStateChanged","onSessionStateChanged","onMediaSession"]),window.__onGCastApiAvailable=this.onCastApiAvailable,this.player.loadResources(this.config.sdk)}},{key:"setAvailable",value:function(e){e!==this._available&&(this._available=e,this.player.dispatch(akamai.amp.Events.PLAYBACK_TARGET_AVAILABILITY_CHANGE,{target:t.ID,available:e}))}},{key:"onCastApiAvailable",value:function(e){e&&(this.castContext=cast.framework.CastContext.getInstance(),this.castContext.addEventListener(cast.framework.CastContextEventType.CAST_STATE_CHANGED,this.onCastStateChanged),this.castContext.addEventListener(cast.framework.CastContextEventType.SESSION_STATE_CHANGED,this.onSessionStateChanged),this.castContext.setOptions({receiverApplicationId:this.config.applicationId,autoJoinPolicy:chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED}))}},{key:"onCastStateChanged",value:function(e){this.setAvailable(e.castState!==cast.framework.CastState.NO_DEVICES_AVAILABLE),this.dispatch(e)}},{key:"onSessionStateChanged",value:function(e){var t=null;switch(e.sessionState){case cast.framework.SessionState.SESSION_STARTING:this.player.pause(),this.player.busy=!0;break;case cast.framework.SessionState.SESSION_RESUMED:if(this.player.busy=!0,this.castSession=e.session,t=e.session.getMediaSession(),t.media&&this.player.media){var a=(this.player.media.sources||[]).map(function(e){return e.src});a.push(this.player.media.src),a.includes(t.media.contentId)&&this.onMediaSession({mediaSession:t})}break;case cast.framework.SessionState.SESSION_STARTED:this.castSession=e.session,this.castSession.addEventListener(cast.framework.SessionEventType.MEDIA_SESSION,this.onMediaSession),null==this.castSession.getMediaSession()&&this.load(this.player.media,this.player.currentTime);break;case cast.framework.SessionState.SESSION_ENDED:t=e.session.getMediaSession(),null!=t&&(this.player.currentTime=e.session.getMediaSession().currentTime),this.player.playbackTarget="amp"}this.dispatch(e)}},{key:"onMediaSession",value:function(e){this.mediaSession=e.mediaSession,this.player.playbackTarget=t.ID,this.dispatch(e)}},{key:"onplaybacktargetchange",value:function(e){e.detail.value===t.ID?this.sender=new i(this):(null!=this.sender&&this.sender.destroy(),this.player.busy=!1)}},{key:"launch",value:function(){var e=this;this.castContext.requestSession().catch(function(t){"cancel"!=t&&e.logger.error(t)})}},{key:"load",value:function(e){var a=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(null!=e){var s=akamai.amp.Utils.selectSource(e.source,function(e){return t.SUPPORTED_TYPES.includes(e)?"maybe":""});if(null!=s){e.src=s.src,e.type=s.type;var n=new chrome.cast.media.GenericMediaMetadata;n.title=e.title,n.subtitle=e.description,n.image=[new chrome.cast.Image(e.poster)],n.releaseDate=e.pubDate&&e.pubDate.toISOString?e.pubDate.toISOString():null;var r=new chrome.cast.media.MediaInfo(s.src,s.type);r.duration=e.duration,r.customData={media:e},r.metadata=n,e.track&&e.track.length>0&&(r.tracks=[],e.track.forEach(function(e,t){var a=new chrome.cast.media.Track(t,chrome.cast.media.TrackType.TEXT);a.subtype=chrome.cast.media.TextTrackType.CAPTIONS,a.name=amp.l10n.MSG_CLOSED_CAPTIONING,a.language=e.srclang,a.customData=e,a.trackContentId=e.src,a.trackContentType=e.type,r.tracks.push(a)}));var o=new chrome.cast.media.LoadRequest(r);o.currentTime=i,this.castSession.loadMedia(o).catch(function(e){return a.logger.error(e)})}}}},{key:"available",get:function(){return this._available}}]),a}(akamai.amp.Plugin);akamai.amp.AMP.registerPlugin("chromecast",akamai.amp.Plugin.createFactory(s)),e.Chromecast=s}(this.akamai.amp.chromecast=this.akamai.amp.chromecast||{});
//# sourceMappingURL=Chromecast.min.js.map