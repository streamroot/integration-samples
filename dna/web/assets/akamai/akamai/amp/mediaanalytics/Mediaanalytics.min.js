!function(e){"use strict";var i=function(e){function i(e,a){babelHelpers.classCallCheck(this,i);var t=babelHelpers.possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e,a));return t.sdk=new JS_AkamaiMediaAnalytics(a.config),t.sdk.disableLocation(),a.iplookup===!1&&t.sdk.disableServerIPLookUp(),t.initialized=!1,t}return babelHelpers.inherits(i,e),babelHelpers.createClass(i,[{key:"setDimensions",value:function(e){var i=this.config.dimensions;for(var a in e){var t=e[a];null!=t&&(i[a]=t)}return this.applyDimensions(i),e}},{key:"amaCallbacks",value:function(e){this.getStreamHeadPosition=function(){if(e)return e.currentTime}}},{key:"applyDimensions",value:function(e){try{for(var i in e)this.sdk.setData(i,this.player.evaluateBindings(e[i]))}catch(e){this.logger.error("[AMP MEDIA ANALYTICS ERROR]","Could not set dimensions:",e)}}},{key:"onready",value:function(e){this.player.addEventListener("adbreakstart",this.onadbreakstart.bind(this)),this.player.addEventListener("adbreakend",this.onadbreakend.bind(this)),this.player.addEventListener("adloaded",this.onadloaded.bind(this)),this.player.addEventListener("adstarted",this.onadstarted.bind(this)),this.player.addEventListener("adended",this.onadended.bind(this)),this.player.addEventListener("adskipped",this.onadbreakskipped.bind(this)),this.player.addEventListener("aderror",this.onaderror.bind(this)),this.player.addEventListener("adfirstquartile",this.onadfirstquartile.bind(this)),this.player.addEventListener("admidpoint",this.onadmidpoint.bind(this)),this.player.addEventListener("adthirdquartile",this.onadthirdquartile.bind(this))}},{key:"onplayrequest",value:function(e){0==this.initialized&&(this.logger.log("[AMP MA EVENT] - handleSessionInit"),this.sdk.handleSessionInit(new this.amaCallbacks(this.player)),this.initialized=!0)}},{key:"onmediasequenceended",value:function(e){this.logger.log("[AMP MA EVENT] - handlePlayEnd"),this.sdk.handlePlayEnd()}},{key:"onplaying",value:function(e){null!=this.player.ads&&this.player.ads.inProgress||(this.logger.log("[AMP MA EVENT] - handlePlaying"),this.sdk.handlePlaying())}},{key:"onmediachange",value:function(e){var i=e.detail,a=null;this.initialized=!1,this.logger.log("[AMP MA EVENT] - setStreamURL",i.src),this.sdk.setStreamURL(i.src,!0);var t=this.config.viewerId||this.config.viewerID||this.config["std:viewerId"];null!=t&&this.sdk.setViewerId(t);var n=i.mediaanalytics;a=null!=n&&null!=n.dimensions?akamia.amp.Utils.override(this.config.dimensions,n.dimensions):this.config.dimensions,this.applyDimensions(a)}},{key:"ondurationchange",value:function(e){this.logger.log("[AMP MA EVENT] - setStreamDuration",e.detail),this.sdk.setStreamDuration(e.detail)}},{key:"updateMedia",value:function(e){this.logger.log("[AMP MA EVENT] - handleTitleSwitch"),this.sdk.handleTitleSwitch(e)}},{key:"onfragmentloadstart",value:function(e){"function"==typeof fragmentDownloadStarted&&fragmentDownloadStarted(e.detail)}},{key:"onadbreakstart",value:function(){this.player.mediaElement.dataset.isad=!0}},{key:"onadbreakend",value:function(){this.player.mediaElement.dataset.isad=!1}},{key:"onadloaded",value:function(e){try{var i=e.data,a={adTitle:i.title,adDuration:i.duration,adPartnerId:i.partner,adId:i.id};this.logger.log("[AMP MA EVENT] - handleAdLoaded"),this.sdk.handleAdLoaded(a)}catch(e){this.logger.error("[AMP MEDIA ANALYTICS ERROR]",e)}}},{key:"onadstarted",value:function(){this.logger.log("[AMP MA EVENT] - handleAdStarted"),this.sdk.handleAdStarted()}},{key:"onadbreakskipped",value:function(){this.logger.log("[AMP MA EVENT] - handleAdSkipped"),this.sdk.handleAdSkipped()}},{key:"onaderror",value:function(e){this.logger.log("[AMP MA EVENT] - handleAdError"),this.sdk.handleAdError(e)}},{key:"onadfirstquartile",value:function(){this.logger.log("[AMP MA EVENT] - handleAdFirstQuartile"),this.sdk.handleAdFirstQuartile()}},{key:"onadmidpoint",value:function(){this.logger.log("[AMP MA EVENT] - handleAdMidPoint"),this.sdk.handleAdMidPoint()}},{key:"onadthirdquartile",value:function(){this.logger.log("[AMP MA EVENT] - handleAdThirdQuartile"),this.sdk.handleAdThirdQuartile()}},{key:"onadended",value:function(){this.logger.log("[AMP MA EVENT] - handleAdComplete"),this.sdk.handleAdComplete()}},{key:"onpause",value:function(){this.logger.log("[AMP MA EVENT] - handlePause"),this.sdk.handlePause()}},{key:"onseeking",value:function(){(this.player.currentTime>.1||0===this.player.currentTime)&&(this.sdk.handleSeekStart(),this.logger.log("[AMP MA EVENT] - handleSeekStart"))}},{key:"onseeked",value:function(){(this.player.currentTime>.1||0===this.player.currentTime)&&(this.sdk.handleSeekEnd(),this.logger.log("[AMP MA EVENT] - handleSeekEnd"))}},{key:"onerror",value:function(e){this.logger.log("[AMP MA EVENT] - handleError",e.detail),this.sdk.handleError(e.detail)}},{key:"onbufferingchange",value:function(e){this.logger.log("[AMP MA EVENT] - handleBufferStart",e.detail),e.detail===!0?this.sdk.handleBufferStart():this.sdk.handleBufferEnd()}},{key:"onqualitychange",value:function(e){this.logger.log("[AMP MA EVENT] - handleBitRateSwitch",e.data.bitrate),this.sdk.handleBitRateSwitch(e.data.bitrate)}}]),i}(akamai.amp.Plugin),a=function(e){function i(e,a){return babelHelpers.classCallCheck(this,i),babelHelpers.possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e,a))}return babelHelpers.inherits(i,e),babelHelpers.createClass(i,[{key:"setDimensions",value:function(e){return this.player.mediaElement.setPlayerProperty("maDimensions",e),e}},{key:"createFlashVars",value:function(e){var i=e.detail.flashvars,a=this.player.config&&this.player.config.media&&this.player.config.media.mediaanalytics;if(null!=a)for(var t in a)i["report_"+t]=a[t]}},{key:"createXML",value:function(e){var i=e.detail.xml,a=i.firstChild,t=i.getElementsByTagName("metrics")[0];null==t&&(t=i.createElement("metrics"),a.appendChild(t));var n=i.createElement("vendor");if(n.setAttribute("id","akamai"),t.appendChild(n),null!=this.config.config){this.createProperty(i,"MEDIA_ANALYTICS_BEACON",this.config.config,n);var s=this.config.plugin.swf||"http://79423.analytics.edgesuite.net/csma/plugin/csma.swf";this.createProperty(i,"MEDIA_ANALYTICS_PLUGIN_PATH",s,n)}null!=this.config.dimensions&&this.createProperty(i,"dimensions",this.config.dimensions,n)}},{key:"onmediachange",value:function(e){var i=e.detail;if(i.mediaanalytics&&i.mediaanalytics.dimensions){i.dimensions=[];for(var a in i.mediaanalytics.dimensions)i.dimensions.push({key:a,value:i.mediaanalytics.dimensions[a]})}}},{key:"flashPlugins",get:function(){return[{id:"OSMFCSMALoader",host:"osmf",main:"com.akamai.playeranalytics.osmf.OSMFCSMALoaderInfo",type:"application/x-shockwave-flash"}]}}]),i}(akamai.amp.FlashPlugin);akamai.amp.AMP.registerPlugin("mediaanalytics","html",akamai.amp.Plugin.createFactory(i)),akamai.amp.AMP.registerPlugin("mediaanalytics","flash",akamai.amp.Plugin.createFactory(a)),e.MediaAnalytics=i}(this.akamai.amp.mediaanalytics=this.akamai.amp.mediaanalytics||{});
//# sourceMappingURL=Mediaanalytics.min.js.map