{"version":3,"file":"Googleanalytics.js","sources":["../../../../src/GoogleAnalytics.js","../../../../src/main.js"],"sourcesContent":["export default class GoogleAnalytics extends akamai.amp.Plugin {\n  constructor(player, config) {\n    super(player, config)\n\n    ga('create', this.config.trackingId, 'auto')\n    ga('send', 'pageview')\n  }\n\n  generateGoogleAnalyticsVO(eventName, type = \"video\") {\n    if (eventName == null)\n      return\n\n    const events = this.config.events[type]\n    if (events == null)\n      return\n\n    const event = events.filter((event) => (event != null && event.type == eventName))[0]\n    if (event == null)\n      return\n\n    const data = event.data || event.detail\n    if (data == null)\n      return\n\n    const vo = {\n      trackingid: this.config.trackingId\n    }\n\n    for (let key in data) {\n      let value = this.player.evaluateBindings(data[key])\n      if (key === \"customDimension\") {\n        let cdim = new Object()\n        for (let dim in value) {\n          let dimValue = value[dim]\n          if (dimValue === \"viewDuration\")\n            dimValue = this.viewDuration\n          ga(\"set\", dim, dimValue)\n          cdim[dim] = dimValue\n        }\n        value = cdim\n      }\n\n      vo[key.toLowerCase()] = value\n    }\n\n    return vo\n  }\n\n  trackEvent(eventName, type = \"video\") {\n    const obj = this.generateGoogleAnalyticsVO(eventName, type)\n    if (obj == null)\n      return\n\n    ga(\"send\", \"event\", obj.eventcategory, obj.eventaction, obj.eventlabel, obj.eventvalue)\n\n    if (obj.customdimension == null)\n      return\n\n    for (let dim in obj.customdimension) {\n      // TODO: Why is this being set to null? \"set\" is called in the VO function with a non-null value\n      ga(\"set\", dim, null)\n    }\n  }\n\n  onready() {\n    this.bindHandlers([\"onadstarted\", \"onadended\"])\n    this.player.addEventListener(\"adstarted\", this.onadstarted)\n    this.player.addEventListener(\"adended\", this.onadended)\n  }\n\n  onstarted() {\n    this.started = true\n    this.currentTime = 0\n    this.viewDuration = 0\n    this.trackEvent(\"started\")\n  }\n\n  onmediachange() {\n    this.onended()\n  }\n\n  onended() {\n    if (this.started === false)\n      return\n\n    this.started = false\n    this.trackEvent(\"ended\")\n  }\n\n  ontimeupdate(event) {\n    const currentTime = Math.round(event.detail)\n    if (currentTime > this.currentTime) {\n      this.viewDuration++\n      this.currentTime = currentTime\n    }\n  }\n\n  onadstarted(event) {\n    this.trackEvent(\"started\", \"ads\")\n  }\n\n  onadended(adVO) {\n    this.trackEvent(\"ended\", \"ads\")\n  }\n}\n","import GoogleAnalytics from \"./GoogleAnalytics.js\"\n\nakamai.amp.AMP.registerPlugin(\"googleanalytics\", akamai.amp.Plugin.createFactory(GoogleAnalytics))\n\nexport {GoogleAnalytics}\n"],"names":["GoogleAnalytics","player","config","trackingId","eventName","type","events","event","filter","data","detail","vo","key","value","evaluateBindings","cdim","Object","dim","dimValue","viewDuration","toLowerCase","obj","generateGoogleAnalyticsVO","eventcategory","eventaction","eventlabel","eventvalue","customdimension","bindHandlers","addEventListener","onadstarted","onadended","started","currentTime","trackEvent","onended","Math","round","adVO","akamai","amp","Plugin","AMP","registerPlugin","createFactory"],"mappings":";;;;;IAAqBA;;;2BACPC,MAAZ,EAAoBC,MAApB,EAA4B;;;8IACpBD,MADoB,EACZC,MADY;;OAGvB,QAAH,EAAa,MAAKA,MAAL,CAAYC,UAAzB,EAAqC,MAArC;OACG,MAAH,EAAW,UAAX;;;;;;8CAGwBC,WAA2B;UAAhBC,IAAgB,uEAAT,OAAS;;UAC/CD,aAAa,IAAjB,EACE;;UAEIE,SAAS,KAAKJ,MAAL,CAAYI,MAAZ,CAAmBD,IAAnB,CAAf;UACIC,UAAU,IAAd,EACE;;UAEIC,QAAQD,OAAOE,MAAP,CAAc,UAACD,KAAD;eAAYA,SAAS,IAAT,IAAiBA,MAAMF,IAAN,IAAcD,SAA3C;OAAd,EAAqE,CAArE,CAAd;UACIG,SAAS,IAAb,EACE;;UAEIE,OAAOF,MAAME,IAAN,IAAcF,MAAMG,MAAjC;UACID,QAAQ,IAAZ,EACE;;UAEIE,KAAK;oBACG,KAAKT,MAAL,CAAYC;OAD1B;;WAIK,IAAIS,GAAT,IAAgBH,IAAhB,EAAsB;YAChBI,QAAQ,KAAKZ,MAAL,CAAYa,gBAAZ,CAA6BL,KAAKG,GAAL,CAA7B,CAAZ;YACIA,QAAQ,iBAAZ,EAA+B;cACzBG,OAAO,IAAIC,MAAJ,EAAX;eACK,IAAIC,GAAT,IAAgBJ,KAAhB,EAAuB;gBACjBK,WAAWL,MAAMI,GAAN,CAAf;gBACIC,aAAa,cAAjB,EACEA,WAAW,KAAKC,YAAhB;eACC,KAAH,EAAUF,GAAV,EAAeC,QAAf;iBACKD,GAAL,IAAYC,QAAZ;;kBAEMH,IAAR;;;WAGCH,IAAIQ,WAAJ,EAAH,IAAwBP,KAAxB;;;aAGKF,EAAP;;;;+BAGSP,WAA2B;UAAhBC,IAAgB,uEAAT,OAAS;;UAC9BgB,MAAM,KAAKC,yBAAL,CAA+BlB,SAA/B,EAA0CC,IAA1C,CAAZ;UACIgB,OAAO,IAAX,EACE;;SAEC,MAAH,EAAW,OAAX,EAAoBA,IAAIE,aAAxB,EAAuCF,IAAIG,WAA3C,EAAwDH,IAAII,UAA5D,EAAwEJ,IAAIK,UAA5E;;UAEIL,IAAIM,eAAJ,IAAuB,IAA3B,EACE;;WAEG,IAAIV,GAAT,IAAgBI,IAAIM,eAApB,EAAqC;;WAEhC,KAAH,EAAUV,GAAV,EAAe,IAAf;;;;;8BAIM;WACHW,YAAL,CAAkB,CAAC,aAAD,EAAgB,WAAhB,CAAlB;WACK3B,MAAL,CAAY4B,gBAAZ,CAA6B,WAA7B,EAA0C,KAAKC,WAA/C;WACK7B,MAAL,CAAY4B,gBAAZ,CAA6B,SAA7B,EAAwC,KAAKE,SAA7C;;;;gCAGU;WACLC,OAAL,GAAe,IAAf;WACKC,WAAL,GAAmB,CAAnB;WACKd,YAAL,GAAoB,CAApB;WACKe,UAAL,CAAgB,SAAhB;;;;oCAGc;WACTC,OAAL;;;;8BAGQ;UACJ,KAAKH,OAAL,KAAiB,KAArB,EACE;;WAEGA,OAAL,GAAe,KAAf;WACKE,UAAL,CAAgB,OAAhB;;;;iCAGW3B,OAAO;UACZ0B,cAAcG,KAAKC,KAAL,CAAW9B,MAAMG,MAAjB,CAApB;UACIuB,cAAc,KAAKA,WAAvB,EAAoC;aAC7Bd,YAAL;aACKc,WAAL,GAAmBA,WAAnB;;;;;gCAIQ1B,OAAO;WACZ2B,UAAL,CAAgB,SAAhB,EAA2B,KAA3B;;;;8BAGQI,MAAM;WACTJ,UAAL,CAAgB,OAAhB,EAAyB,KAAzB;;;;EAtGyCK,OAAOC,GAAP,CAAWC;;ACExDF,OAAOC,GAAP,CAAWE,GAAX,CAAeC,cAAf,CAA8B,iBAA9B,EAAiDJ,OAAOC,GAAP,CAAWC,MAAX,CAAkBG,aAAlB,CAAgC5C,eAAhC,CAAjD,EAEA;;;;"}