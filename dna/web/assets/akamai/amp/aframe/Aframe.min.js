this.akamai=this.akamai||{},this.akamai.amp=this.akamai.amp||{},this.akamai.amp.aframe=function(e){"use strict";var t={AUDIO:"audio",VIDEO:"video",NONE:"none"},n=akamai.amp.Utils,i=function(){function e(){babelHelpers.classCallCheck(this,e)}return babelHelpers.createClass(e,null,[{key:"isCompatible",value:function(){var t=e.detectVRDisplay()||e.detectWebGLContext();return t===!1&&console.log("Your browser is not compatible with A-Frame check this page out https://get.webgl.org/"),t}},{key:"detectVRDisplay",value:function(){return"function"==typeof navigator.getVRDisplays}},{key:"detectWebGLContext",value:function(){var e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl");return t&&t instanceof WebGLRenderingContext}},{key:"createOverlay",value:function(){var e=function(){var e=this,t=document.querySelectorAll("a-scene");t.forEach(function(t){e.removeChild(t)})},t=document.createElement("div");return t.className="amp-vr-overlay",t.clear=e,t}},{key:"createCamera",value:function(){var e=document.createElement("a-camera");return e.setAttribute("user-height",0),e.setAttribute("look-controls","pointerLockEnabled:false;reverseMouseDrag:true;reverseTouchDrag:true"),e.setAttribute("compass","enabled:true"),e}},{key:"isMobile",value:function(){return e.isTouchDevice()||!e.isDesktop()}},{key:"isTouchDevice",value:function(){return n.isTouchDevice()}},{key:"isDesktop",value:function(){return"desktop"===n.getDevice()}}]),e}(),a={ENTER_VR:"entervr",EXIT_VR:"exitvr",LOADED:"loaded"},o=function(){function e(t){babelHelpers.classCallCheck(this,e),this.plugin=t,this.player=t.player,this.data=t.data,this.elements=this.createElements();var n=t.overlay,a=this.elements.scene,o=i.createCamera();t.initialized&&n.clear(),n.appendChild(a),0==this.data.vrmode&&i.isMobile()&&o.setAttribute("touch-controls","pointerLockEnabled:false;reverseMouseDrag:true;reverseTouchDrag:true"),a.appendChild(o),t.initialized=!0}return babelHelpers.createClass(e,[{key:"createElements",value:function(){var e=document.createElement("a-scene"),t=document.createElement("a-videosphere"),n=document.createElement("a-sky"),a=this.plugin.available&&this.data.native===!0,o=i.isMobile()&&this.data.disableDevicePermissionUI!==!0;return e.setAttribute("embedded",!0),e.setAttribute("vr-mode-ui","enabled: ".concat(a)),e.setAttribute("device-orientation-permission-ui","enabled: ".concat(o)),this.addListeners(e),{scene:e,sphere:t,sky:n}}},{key:"addListeners",value:function(e){var t=this,n=["renderstart","enter-vr","exit-vr","loaded"];this.handleEvent=this.handleEvent.bind(this),n.map(function(n){return e.addEventListener(n,t.handleEvent)})}},{key:"updatePlayerState",value:function(e){var n=t,i="amp-aframe";for(var a in n)if(n.hasOwnProperty(a)){var o="".concat(i,"-").concat(n[a]);this.player.container.classList.remove(o)}this.player.container.classList.add("".concat(i,"-").concat(e))}},{key:"getName",value:function(){return this.name}},{key:"render",value:function(){}},{key:"enterVR",value:function(){var e=this.elements.scene;e.hasLoaded?e.enterVR():e.addEventListener("loaded",function(){setTimeout(function(){e.enterVR()},1e3)})}},{key:"exitVR",value:function(){var e=this.elements.scene;e.hasLoaded?e.exitVR():e.addEventListener("loaded",function(){setTimeout(function(){e.exitVR()},1e3)})}},{key:"handleEvent",value:function(e){var t,n={};switch(e.type){case"enter-vr":t=a.ENTER_VR,this.plugin.setDisplayState("vr");break;case"exit-vr":t=a.EXIT_VR,this.plugin.setDisplayState("normal");break;case"loaded":t=a.LOADED}null!=t&&this.dispatch(t,n)}},{key:"dispatch",value:function(e,t){var n=new akamai.amp.Event(e,t);this.plugin.dispatchEvent(n),this.plugin.logger.log("[AMP AFRAME EVENT] ".concat(e),n)}}]),e}(),s=function(e){function n(t){var i;return babelHelpers.classCallCheck(this,n),i=e.call(this,t)||this,i.render(),i}return babelHelpers.inherits(n,e),babelHelpers.createClass(n,[{key:"render",value:function(){var e=this.elements,n=e.sky,i=e.scene;n.setAttribute("src",this.player.media.poster),i.appendChild(n),this.updatePlayerState(t.AUDIO)}}]),n}(o),r=function(e){function n(t){var i;return babelHelpers.classCallCheck(this,n),i=e.call(this,t)||this,i.player.mediaElement.setAttribute("id","videoamp"),i.render(),i}return babelHelpers.inherits(n,e),babelHelpers.createClass(n,[{key:"render",value:function(){var e=this.elements,n=e.sphere,i=e.scene;return this.shouldRenderVR()?(n.setAttribute("rotation",this.data.rotation||"0 180 0"),n.setAttribute("src","#videoamp"),i.appendChild(n),void this.updatePlayerState(t.VIDEO)):void this.updatePlayerState(t.NONE)}},{key:"shouldRenderVR",value:function(){var e=this.player.media.category||"",t=null==this.data.pattern?new RegExp("360","i"):new RegExp(this.data.pattern,"i"),n=this.data.strict===!0?t:new RegExp("","i");return n.test(e)}}]),n}(o),c=function(){function e(){babelHelpers.classCallCheck(this,e)}return babelHelpers.createClass(e,[{key:"addComponent",value:function(e){return this.register(e)}},{key:"register",value:function(){}}]),e}(),u=Math.PI/2,l=function(e){function t(){return babelHelpers.classCallCheck(this,t),e.call(this)||this}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"register",value:function(){AFRAME.registerComponent("touch-controls",{schema:{enabled:{default:!0},hmdEnabled:{default:!0},pointerLockEnabled:{default:!1},reverseMouseDrag:{default:!1},reverseTouchDrag:{default:!1},touchEnabled:{default:!0}},init:function(){this.deltaYaw=0,this.previousHMDPosition=new THREE.Vector3,this.hmdQuaternion=new THREE.Quaternion,this.magicWindowAbsoluteEuler=new THREE.Euler,this.magicWindowDeltaEuler=new THREE.Euler,this.position=new THREE.Vector3,this.magicWindowObject=new THREE.Object3D,this.rotation={},this.deltaRotation={},this.savedPose=null,this.pointerLocked=!1,this.setupTouchControls(),this.bindMethods(),this.previousMouseEvent={},this.savedPose={position:new THREE.Vector3,rotation:new THREE.Euler},this.el.sceneEl.is("vr-mode")&&this.onEnterVR()},update:function(e){var t=this.data;t.enabled!==e.enabled&&this.updateGrabCursor(t.enabled),!e||t.hmdEnabled||e.hmdEnabled||(this.pitchObject.rotation.set(0,0,0),this.yawObject.rotation.set(0,0,0)),e&&!t.pointerLockEnabled!==e.pointerLockEnabled&&(this.removeEventListeners(),this.addEventListeners(),this.pointerLocked&&this.exitPointerLock())},tick:function(e){var t=this.data;t.enabled&&this.updateOrientation()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.pointerLocked&&this.exitPointerLock()},remove:function(){this.removeEventListeners(),this.pointerLocked&&this.exitPointerLock()},bindMethods:function(){this.onTouchStart=AFRAME.utils.bind(this.onTouchStart,this),this.onTouchMove=AFRAME.utils.bind(this.onTouchMove,this),this.onTouchEnd=AFRAME.utils.bind(this.onTouchEnd,this)},setupTouchControls:function(){this.pitchObject=new THREE.Object3D,this.yawObject=new THREE.Object3D,this.yawObject.position.y=10,this.yawObject.add(this.pitchObject)},addEventListeners:function(){var e=this.el.sceneEl,t=e.canvas;return t?(t.addEventListener("touchstart",this.onTouchStart),window.addEventListener("touchmove",this.onTouchMove),window.addEventListener("touchend",this.onTouchEnd),void(this.data.pointerLockEnabled&&(document.addEventListener("pointerlockchange",this.onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",this.onPointerLockChange,!1),document.addEventListener("pointerlockerror",this.onPointerLockError,!1)))):void e.addEventListener("render-target-loaded",AFRAME.utils.bind(this.addEventListeners,this))},removeEventListeners:function(){var e=this.el.sceneEl,t=e&&e.canvas;t&&(t.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onMouseUp),t.removeEventListener("touchstart",this.onTouchStart),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd),document.removeEventListener("pointerlockchange",this.onPointerLockChange,!1),document.removeEventListener("mozpointerlockchange",this.onPointerLockChange,!1),document.removeEventListener("pointerlockerror",this.onPointerLockError,!1))},updateOrientation:function(){var e=new THREE.Matrix4;return function(){var t,n=this.el.object3D,i=this.pitchObject,a=this.yawObject,o=this.el.sceneEl;return o.is("vr-mode")&&o.checkHeadsetConnected()?void(o.hasWebXR&&(t=o.renderer.xr.getCameraPose(),t&&(e.elements=t.transform.matrix,e.decompose(n.position,n.rotation,n.scale)))):(n.rotation.x=this.magicWindowDeltaEuler.x+i.rotation.x,n.rotation.y=this.magicWindowDeltaEuler.y+a.rotation.y,void(n.rotation.z=this.magicWindowDeltaEuler.z))}}(),onMouseMove:function(e){var t,n,i,a=this.pitchObject,o=this.previousMouseEvent,s=this.yawObject;this.data.enabled&&(this.mouseDown||this.pointerLocked)&&(this.pointerLocked?(n=e.movementX||e.mozMovementX||0,i=e.movementY||e.mozMovementY||0):(n=e.screenX-o.screenX,i=e.screenY-o.screenY),this.previousMouseEvent.screenX=e.screenX,this.previousMouseEvent.screenY=e.screenY,t=this.data.reverseMouseDrag?1:-1,s.rotation.y+=.002*n*t,a.rotation.x+=.002*i*t,a.rotation.x=Math.max(-u,Math.min(u,a.rotation.x)))},onMouseDown:function(e){var t=this.el.sceneEl;if(!(!this.data.enabled||t.is("vr-mode")&&t.checkHeadsetConnected())&&0===e.button){var n=t&&t.canvas;this.mouseDown=!0,this.previousMouseEvent.screenX=e.screenX,this.previousMouseEvent.screenY=e.screenY,this.showGrabbingCursor(),this.data.pointerLockEnabled&&!this.pointerLocked&&(n.requestPointerLock?n.requestPointerLock():n.mozRequestPointerLock&&n.mozRequestPointerLock())}},showGrabbingCursor:function(){this.el.sceneEl.canvas.style.cursor="grabbing"},hideGrabbingCursor:function(){this.el.sceneEl.canvas.style.cursor=""},onMouseUp:function(){this.mouseDown=!1,this.hideGrabbingCursor()},onTouchStart:function(e){1===e.touches.length&&this.data.touchEnabled&&!this.el.sceneEl.is("vr-mode")&&(this.touchStart={x:e.touches[0].pageX,y:e.touches[0].pageY},this.touchStarted=!0)},onTouchMove:function(e){var t,n,i=this.el.sceneEl.canvas,a=this.yawObject;this.touchStarted&&this.data.touchEnabled&&(n=2*Math.PI*(e.touches[0].pageX-this.touchStart.x)/i.clientWidth,t=this.data.reverseTouchDrag?1:-1,a.rotation.y-=.5*n*t,this.touchStart={x:e.touches[0].pageX,y:e.touches[0].pageY})},onTouchEnd:function(){this.touchStarted=!1},onPointerLockChange:function(){this.pointerLocked=!(!document.pointerLockElement&&!document.mozPointerLockElement)},onPointerLockError:function(){this.pointerLocked=!1},exitPointerLock:function(){document.exitPointerLock(),this.pointerLocked=!1},updateGrabCursor:function(e){function t(){i.canvas.classList.add("a-grab-cursor")}function n(){i.canvas.classList.remove("a-grab-cursor")}var i=this.el.sceneEl;return i.canvas?e?void t():void n():void(e?i.addEventListener("render-target-loaded",t):i.addEventListener("render-target-loaded",n))},saveCameraPose:function(){var e=this.el;this.savedPose.position.copy(e.object3D.position),this.savedPose.rotation.copy(e.object3D.rotation),this.hasSavedPose=!0},restoreCameraPose:function(){var e=this.el,t=this.savedPose;this.hasSavedPose&&(e.object3D.position.copy(t.position),e.object3D.rotation.copy(t.rotation),this.hasSavedPose=!1)}})}}]),t}(c),h=function(e){function t(n){var i;return babelHelpers.classCallCheck(this,t),i=e.call(this)||this,i.container=n.container,i.element=i.createElement(),i}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"createElement",value:function(){var e=document.createElement("div");return e.className="amp-compass",this.container.appendChild(e),e}},{key:"register",value:function(){var e=this.element;AFRAME.registerComponent("compass",{init:function(){this.compass=e,this.degree=360},tick:function(){var e=this.el.getAttribute("rotation").y||0,t=this.degree-e;this.compass.style.transform="rotate("+t+"deg)"}})}}]),t}(c),d=function(){function e(){babelHelpers.classCallCheck(this,e)}return babelHelpers.createClass(e,[{key:"registerComponent",value:function(e,t){var n;return"touch"===e&&(n=new l),"compass"===e&&(n=new h({container:t})),n.register()}}]),e}(),v=function(e){function t(n,a){var o;return babelHelpers.classCallCheck(this,t),o=e.call(this,n,a)||this,o.overlay=i.createOverlay(),o.initialized=!1,o._available=o.data.vrmode!==!1&&i.isCompatible(),o.registry=new d,o}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"available",get:function(){return this._available}},{key:"setAvailable",value:function(e){this._available=e}},{key:"displayState",get:function(){return this._displayState||"normal"}},{key:"setDisplayState",value:function(e){this._displayState=e}},{key:"enterVR",value:function(){this.initialized&&this.renderer.enterVR()}},{key:"exitVR",value:function(){this.initialized&&this.renderer.exitVR()}},{key:"registerComponents",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.overlay,i=["touch","compass"];i.forEach(function(i){t.hasOwnProperty(i)&&t[i].enabled===!1||e.registry.registerComponent(i,n)})}},{key:"onready",value:function(){var e=this.overlay;this.player.container.appendChild(e),this.registerComponents(this.data.components)}},{key:"oncanplaythrough",value:function(){var e=document.querySelector(".a-canvas");e&&e.hasAttribute("height")&&(e.height+=1)}},{key:"onmediachange",value:function(e){this.media=e.data||{}}},{key:"onmediasequenceinitialized",value:function(e){var t=this.media;"audio"===t.medium?this.renderer=new s(this):this.renderer=new r(this)}}]),t}(akamai.amp.Plugin);akamai.amp.AMP.registerPlugin("aframe","function"==typeof akamai.amp.Plugin.createFactory?akamai.amp.Plugin.createFactory(v):v.factory);var m={Aframe:v,Events:a};return akamai.amp.aframe=akamai.amp.aframe||{},akamai.amp.aframe=m,e.module=m,Object.defineProperty(e,"__esModule",{value:!0}),e}({});