this.akamai=this.akamai||{},this.akamai.amp=this.akamai.amp||{},this.akamai.amp.chromecast=function(e){"use strict";function t(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,i)}return a}function a(e){for(var a=1;a<arguments.length;a++){var i=null!=arguments[a]?arguments[a]:{};a%2?t(Object(i),!0).forEach(function(t){babelHelpers.defineProperty(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):t(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}var i=function(){function e(){babelHelpers.classCallCheck(this,e)}return babelHelpers.createClass(e,null,[{key:"ID",get:function(){return"chromecast"}},{key:"CHANNEL_ID",get:function(){return"urn:x-cast:com.akamai.amp.cast"}},{key:"APPLICATION_ID",get:function(){return"CC1AD845"}},{key:"SUPPORTED_TYPES",get:function(){return[akamai.amp.Utils.mimeTypes.m3u8,akamai.amp.Utils.mimeTypes.mp4,akamai.amp.Utils.mimeTypes.mpd,akamai.amp.Utils.mimeTypes.ism,akamai.amp.Utils.mimeTypes.webm,akamai.amp.Utils.mimeTypes.mp3]}},{key:"KEY_SYSTEM",get:function(){return{"com.microsoft.playready":"playready","com.widevine.alpha":"widevine",default:"none"}}},{key:"SENDER_STATES",get:function(){return{SESSION_STARTING:"amp-remote-connecting",SESSION_STARTED:"amp-remote-connected",SESSION_START_FAILED:"amp-remote-failed",SESSION_RESUMED:"amp-remote-connected"}}},{key:"PRESET_FONT_FAMILY",get:function(){return{proportionalSansSerif:"SANS_SERIF",monospacedSansSerif:"MONOSPACED_SANS_SERIF",proportionalSerif:"SERIF",monospacedSerif:"MONOSPACED_SERIF",casual:"CASUAL",cursive:"CURSIVE",smallCapitals:"SMALL_CAPITALS"}}},{key:"PRESET_FONT_SIZE",get:function(){return{smallest:.5,small:.75,medium:1,large:1.5,largest:2}}},{key:"PRESET_EDGE_TYPE",get:function(){return{raised:"RAISED",uniform:"OUTLINE",depressed:"DEPRESSED",none:"NONE",leftShadow:"DROP_SHADOW",rightShadow:"DROP_SHADOW"}}},{key:"CAST_CAPTION_TYPE",get:function(){return{"text/cea-608":"text/cea608","text/vtt":"text/vtt","application/ttml+xml":"application/ttml+xml"}}}]),e}(),s=function(){function e(){babelHelpers.classCallCheck(this,e)}return babelHelpers.createClass(e,null,[{key:"createTextTrackStyle",value:function(e){var t={fontFamily:"fontFamily",fontSize:"fontScale",edgeType:"edgeType",fontColor:"foregroundColor",backgroundColor:"backgroundColor",edgeColor:"edgeColor",windowColor:"windowColor"},a=new chrome.cast.media.TextTrackStyle,s=e,n=e.presets;for(var r in s){var o=t[r];if(o){var c=s[r];switch(o){case"fontFamily":var l=i.PRESET_FONT_FAMILY[c];a.fontFamily=l,a.fontGenericFamily=l;break;case"fontScale":var u=i.PRESET_FONT_SIZE[c];a.fontScale=u;break;case"edgeType":var h=i.PRESET_EDGE_TYPE[c];a.edgeType=h,a.windowType=chrome.cast.media.TextTrackWindowType.NORMAL;break;case"foregroundColor":case"backgroundColor":case"edgeColor":case"windowColor":var m=r.replace(/color/i,"Opacity"),d=n.color.hasOwnProperty(c)?n.color[c]:c,p=s[m];a[o]=this.rgbToHex(d,p)}}}return a}},{key:"rgbToHex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"0%",a=e.replace(/[^\d,]/g,"").split(","),i=parseInt(t.replace("%","")),s="01";return!Number.isNaN(i)&&0<i&&(s=parseInt((255*i/100).toFixed(0)).toString(16)),"#".concat(((1<<24)+(+a[0]<<16)+(+a[1]<<8)+ +a[2]).toString(16).slice(1)).concat(s)}},{key:"createMetadata",value:function(e){var t=new chrome.cast.media.GenericMediaMetadata;return t.title=e.title,t.subtitle=e.description,t.image=[new chrome.cast.Image(e.poster)],t.releaseDate=e.pubDate&&e.pubDate.toISOString?e.pubDate.toISOString():null,t}},{key:"createTrack",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,a=new chrome.cast.media.Track(e,chrome.cast.media.TrackType.TEXT);return a.subtype=chrome.cast.media.TextTrackType.CAPTIONS,a.name="".concat(t.srclang," Captions"),a.language=t.srclang,a.customData=t,a.trackContentId=t.src,a.trackContentType=i.CAST_CAPTION_TYPE[t.type]||t.type,a}}]),e}(),n=function(e){function t(a){var i;return babelHelpers.classCallCheck(this,t),i=e.call(this)||this,i.player=a.player,i.plugin=a.plugin,i._hidden=i.player.captioning.hidden,i._tracks=[],i.onEditTracksInfoSuccess=i.onEditTracksInfoSuccess.bind(babelHelpers.assertThisInitialized(i)),i.onEditTracksInfoError=i.onEditTracksInfoError.bind(babelHelpers.assertThisInitialized(i)),i.textTrackStyle,i.track=i.selectTrack(),i.hidden||i.selectTrackByLanguage(i.track.language),i}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"tracks",get:function(){var e=this.plugin.mediaSession;return null==e||null==e.media||null==e.media.tracks?[]:e.media.tracks.filter(function(e){return e.subtype==chrome.cast.media.TextTrackType.CAPTIONS?e:null})}},{key:"track",get:function(){return this._track||{}},set:function(e){this._track=e}},{key:"hidden",get:function(){return this._hidden},set:function(e){return e?this.requestEditTracksInfo([]):this.requestEditTracksInfo([this.track.trackId]),this.dispatch("visibilitychange",!e),this._hidden=e,this._hidden}},{key:"onEditTracksInfoSuccess",value:function(e){}},{key:"onEditTracksInfoError",value:function(e){}},{key:"selectTrackByLanguage",value:function(e){var t=this.tracks.filter(function(t){return t.language===e})[0];if(null!=t){this.track=t;var a=[this.track.trackId];this.requestEditTracksInfo(a)}return t}},{key:"changeSettings",value:function(e){null!=e&&(this.player.captioning.changeSettings(e),this.hidden||this.requestEditTracksInfo([this.track.trackId],s.createTextTrackStyle(this.player.captioning.settings)))}},{key:"selectTrack",value:function(){var e=this.player.captioning.track,t=[];return e&&this.tracks&&(t=this.tracks.filter(function(t){return t.language===e.language})),t.length?t.shift():{}}},{key:"requestEditTracksInfo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.createTextTrackStyle(this.player.captioning.settings),a=new chrome.cast.media.EditTracksInfoRequest(e,t);this.plugin.mediaSession.editTracksInfo(a,this.onEditTracksInfoSuccess,this.onEditTracksInfoError)}},{key:"onvisibilitychange",value:function(e){var t=e.detail;this.player.captioning.changeSettings({visible:t})}}]),t}(akamai.amp.EventDispatcher),r=akamai.amp.PreviewTrack,o=10,c=function(e){function t(a){var i;return babelHelpers.classCallCheck(this,t),i=e.call(this)||this,cast.framework.setLoggerLevel(a.debug?cast.framework.LoggerLevel.DEBUG:cast.framework.LoggerLevel.NONE),i.player=a.player,i.config=akamai.amp.Utils.clone(i.player.config),i.plugin=a,i.state={playState:akamai.amp.PlayState.READY,waiting:!1,seeking:!1},i.onRemotePlayerChange=i.onRemotePlayerChange.bind(babelHelpers.assertThisInitialized(i)),i.onMediaSession=i.onMediaSession.bind(babelHelpers.assertThisInitialized(i)),i.onMediaSession(),i.plugin.castSession.addEventListener(cast.framework.SessionEventType.MEDIA_SESSION,i.onMediaSession),i.createElements(),i.loadPlugins().then(function(){i.dispatch(akamai.amp.Events.READY),i.dispatch(akamai.amp.Events.MEDIA_CHANGE,i.media),i.dispatch(akamai.amp.Events.DURATION_CHANGE,i.duration||0),i.dispatch(akamai.amp.Events.CAN_PLAY_THROUGH)}),i.previewTracks=i.player.previewTracks,i}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"createElements",value:function(){this.container=document.createElement("div"),this.container.className="amp-chromecast-sender",this.player.container.appendChild(this.container),this.message=document.createElement("div"),this.message.className="amp-chromecast-sender-msg";var e=document.createElement("div");e.className="amp-chromecast-sender-text",e.innerHTML=this.getLocalizedString("MSG_CHROMECAST_MESSAGE",{device:this.plugin.castSession.getCastDevice().friendlyName}),this.message.appendChild(e),this.player.container.appendChild(this.message)}},{key:"loadPlugins",value:function(){var e=this;this.chromecast={available:!0,launch:function(){return e.plugin.launch()}},null!=this.player.captioning&&(this.captioning=new n(this)),this.localization={getLanguageString:function(t){return e.player.localization.getLanguageString(t)},getString:function(t){return e.player.localization.getString(t)}},this.player.mode;var t="react",a=akamai.amp.AMP.plugins[t],i=this.config.plugins.react;if(i.mode=akamai.amp.react.Mode.PERSISTENT,null==a)throw new Error("[AMP] Plugin could not be found: ".concat(t));return a(this,i,t).then(function(a){e[t]=a,null!=a.feature&&(e[a.feature]=a),a.container.classList.add("amp-remote-playback"),e.logger.log("[AMP] Plugin registered: ".concat(t))}).catch(function(t){return e.logger.error(t)})}},{key:"onRemotePlayerChange",value:function(e){var t=this;this.logger.log("[AMP CHROMECAST EVENT]",e.field,e.value),cast.framework.RemotePlayerEventType;var a=akamai.amp.Events,i=e.value;switch(e.field){case"liveSeekableRange":null!=i&&(this.duration=i.end);break;case"mediaInfo":if(null==this.state.media&&null!=i){if(this.state.media=i,this.playState=this.remotePlaybackState,i.customData&&i.customData.media){var s=i.customData.media;this.duration=i.duration,this.dispatch(akamai.amp.Events.TEMPORAL_TYPE_CHANGE,s.temporalType),"live"===s.temporalType&&(this.dispatch(akamai.amp.Events.IS_LIVE,s.isLive),this.updateComponentState("amp-live",s.isLive)),this.previewTracks&&this.addPreviewTrack(s.track)}this.dispatch(akamai.amp.Events.MEDIA_CHANGE,i)}else null==i&&(this.state.media=null);break;case"isMediaLoaded":i===!1&&(this.playState=akamai.amp.PlayState.ENDED);break;case"currentTime":if(this.playState=this.remotePlaybackState,"dvr"===this.media.temporalType&&i>=this.duration){var n;this.duration=null===(n=this.getLiveSeekableRange())||void 0===n?void 0:n.end}else i<this.duration-2*o&&this.dispatch(akamai.amp.Events.IS_LIVE,!1);this.seeking===!0&&(this.dispatch(akamai.amp.Events.CAN_PLAY_THROUGH),this.dispatch(akamai.amp.Events.SEEKED),this.state.seeking=!1),this.waiting===!0&&(this.waiting=!1),this.dispatch(a.TIME_UPDATE,this.currentTime);break;case"duration":this.playState=this.remotePlaybackState,this.dispatch(a.DURATION_CHANGE,this.duration);break;case"volumeLevel":this.dispatch(a.VOLUME_CHANGE,this.volume);break;case"isMuted":this.dispatch(a.VOLUME_CHANGE,i?0:this.volume),this.dispatch(a.MUTE_CHANGE,this.muted);break;case"playerState":var r=null;switch(i){case chrome.cast.media.PlayerState.PLAYING:r=akamai.amp.PlayState.PLAYING;break;case chrome.cast.media.PlayerState.PAUSED:r=akamai.amp.PlayState.PAUSED;break;case chrome.cast.media.PlayerState.BUFFERING:this.waiting=!0}r&&(this.playState=r);break;case"savedPlayerState":var c=e.value,l=c.currentTime,u=void 0===l?0:l,h=c.isPaused;this.player.play().then(function(){return t.player.seek(u).then(function(){return h&&t.player.pause()})})}this.dispatch(e)}},{key:"onMediaSession",value:function(e){this.logger.log("[AMP CHROMECAST EVENT]",e),null!=this.remotePlayerController&&this.remotePlayerController.removeEventListener(cast.framework.RemotePlayerEventType.ANY_CHANGE,this.onRemotePlayerChange),this.remotePlayer=new cast.framework.RemotePlayer,this.remotePlayerController=new cast.framework.RemotePlayerController(this.remotePlayer),this.remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.ANY_CHANGE,this.onRemotePlayerChange),this.dispatch(e)}},{key:"updateComponentState",value:function(e,t){var a=this.ui;a.container&&(t?a.container.classList.add(e):a.container.classList.remove(e))}},{key:"evaluateBindings",value:function(e,t){var a={media:this.media,player:{mode:"html5"},now:Date.now()};return akamai.amp.DataBinding.evaluateBindings(e,akamai.amp.Utils.override(a,t))}},{key:"context",get:function(){var e;return null!==(e=this.plugin.castContext)&&void 0!==e?e:cast.framework.CastContext.getInstance()}},{key:"timers",get:function(){return this.plugin.timers}},{key:"mediaElement",get:function(){return{}}},{key:"logger",get:function(){return this.plugin.logger}},{key:"currentTime",get:function(){return this.remotePlayer.currentTime},set:function(e){e!=this.state.currentTime&&(this.state.seeking=!0,this.state.currentTime=e,this.remotePlayer.currentTime=e,this.paused===!1&&this.dispatch(akamai.amp.Events.SEEKING),this.remotePlayerController.seek())}},{key:"duration",get:function(){return"dvr"===this.media.temporalType?this._duration||0:this.remotePlayer.duration},set:function(e){null!=e&&this._duration!=e&&(this._duration=e,this.dispatch(akamai.amp.Events.DURATION_CHANGE,e))}},{key:"autoplay",get:function(){return!0},set:function(e){}},{key:"media",get:function(){var e=this.plugin.mediaSession;return null!=e&&null!=e.media.customData?e.media.customData.media:this.player.media},set:function(e){this.plugin.load(this.player.defaultMediaTransform(e))}},{key:"volume",get:function(){return this.remotePlayer.volumeLevel},set:function(e){this.remotePlayer.volumeLevel=e,this.remotePlayerController.setVolumeLevel()}},{key:"muted",get:function(){return this.remotePlayer.isMuted},set:function(e){this.remotePlayerController.muteOrUnmute()}},{key:"playbackRate",get:function(){return 1},set:function(e){}},{key:"waiting",get:function(){return this.state.waiting},set:function(e){e!=this.state.waiting&&(this.state.waiting=e,e&&this.dispatch(akamai.amp.Events.WAITING))}},{key:"seeking",get:function(){return this.state.seeking}},{key:"paused",get:function(){return this.remotePlayer.isPaused}},{key:"ended",get:function(){return!1}},{key:"quality",get:function(){return 0},set:function(e){}},{key:"qualityMode",get:function(){return"auto"}},{key:"qualityLevels",get:function(){return[]}},{key:"audioTracks",get:function(){return[]}},{key:"playState",get:function(){return this.state.playState},set:function(e){var t=this.state.playState;if(e!=t)switch(this.state.playState=e,this.dispatch(akamai.amp.Events.PLAY_STATE_CHANGE,{previous:t,value:e}),e){case akamai.amp.PlayState.PLAYING:this.dispatch(akamai.amp.Events.PLAYING);break;case akamai.amp.PlayState.PAUSED:this.dispatch(akamai.amp.Events.PAUSE);break;case akamai.amp.PlayState.ENDED:this.dispatch(akamai.amp.Events.ENDED)}}},{key:"previewTracks",get:function(){return this.getPreviewTracks()},set:function(e){return this.setPreviewTracks(e)}},{key:"viewComponent",get:function(){return this.container}},{key:"settings",get:function(){return this.player.settings}},{key:"remotePlaybackState",get:function(){return this.remotePlayer&&this.remotePlayer.playerState.toLowerCase()}},{key:"play",value:function(){this.remotePlayerController.playOrPause()}},{key:"pause",value:function(){this.remotePlayerController.playOrPause()}},{key:"goLive",value:function(){this.currentTime=this.getLiveSeekableRange().end-o,this.dispatch(akamai.amp.Events.IS_LIVE,!0)}},{key:"getLiveSeekableRange",value:function(){var e={end:0,start:0},t=this.context.getCurrentSession();if(null!=t){var i=t.getMediaSession();if(null!=i)return a(a({},e),i.getEstimatedLiveSeekableRange())}}},{key:"getLocalizedString",value:function(e,t){return this.player.getLocalizedString(e,t)}},{key:"getPreviewTracks",value:function(){return this._previewTracks}},{key:"setPreviewTracks",value:function(e){this._previewTracks=e}},{key:"addPreviewTrack",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=function(t){return e.previewTracks.remove(t),t},i=function(e){return"preview"===e.kind||"thumbnail"===e.kind},s=function(t){return e.previewTracks.add(t)},n=function(e){return new r(e)};t.filter(i).map(n).map(a).map(s)}},{key:"destroy",value:function(){null!=this.remotePlayerController&&this.remotePlayerController.removeEventListener(cast.framework.RemotePlayerEventType.ANY_CHANGE,this.onRemotePlayerChange),this.plugin.castSession.removeEventListener(cast.framework.SessionEventType.MEDIA_SESSION,this.onMediaSession),this.player.container.removeChild(this.container),this.player.container.removeChild(this.message)}}]),t}(akamai.amp.EventDispatcher),l={en:{MSG_CHROMECAST_MESSAGE:"Video playing on ${device}"},es:{MSG_CHROMECAST_MESSAGE:"Contenido se está reproduciendo en ${device}"},fr:{MSG_CHROMECAST_MESSAGE:"Lecture de vidéo sur ${device}"}},u=akamai.fp,h=function(e){function t(a,i){var s;return babelHelpers.classCallCheck(this,t),s=e.call(this,a,i)||this,s._available=!1,s.timers=akamai.amp.Utils.timerGroup("chromecast"),s}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"onready",value:function(){this.bindHandlers(["onCastApiAvailable","onCastStateChanged","onSessionStateChanged","onMediaSession","onCastApiFound"]),window.__onGCastApiAvailable=this.onCastApiAvailable,document.addEventListener("castApiFound",this.onCastApiFound),this.player.loadResources(this.config.sdk),null!=window.__gCastApiAvailable&&(this.onCastApiAvailable(window.__gCastApiAvailable),this.setAvailable(this.castState!==cast.framework.CastState.NO_DEVICES_AVAILABLE))}},{key:"available",get:function(){return this._available}},{key:"namespace",get:function(){return"akamai_amp_cast"}},{key:"locales",get:function(){var e=[l];return this.config.locales&&e.push(this.config.locales),e}},{key:"castState",get:function(){return this.getCastState()},set:function(e){this.setCastState(e)}},{key:"getCastState",value:function(){return this._castState||cast.framework.CastState.NOT_CONNECTED}},{key:"setCastState",value:function(e){this._castState=e}},{key:"session",get:function(){return this.getSession()},set:function(e){this.setSession(e)}},{key:"getSession",value:function(){var e={};try{e=localStorage.getItem(this.namespace),null!=e&&(e=JSON.parse(e))}catch(t){e=this._session}return e}},{key:"setSession",value:function(e){try{localStorage.setItem(this.namespace,JSON.stringify(e))}catch(t){this._session=JSON.stringify(e)}}},{key:"setAvailable",value:function(e){e!==this._available&&(this._available=e,this.player.dispatch(akamai.amp.Events.PLAYBACK_TARGET_AVAILABILITY_CHANGE,{target:i.ID,available:e}))}},{key:"onCastApiFound",value:function(e){var t=e.detail.available;t&&"cast"in chrome&&(this.castContext=cast.framework.CastContext.getInstance(),this.castContext.addEventListener(cast.framework.CastContextEventType.CAST_STATE_CHANGED,this.onCastStateChanged),this.castContext.addEventListener(cast.framework.CastContextEventType.SESSION_STATE_CHANGED,this.onSessionStateChanged),this.castContext.setOptions({receiverApplicationId:this.config.applicationId,autoJoinPolicy:chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED}))}},{key:"onCastApiAvailable",value:function(e){if(e){var t=new CustomEvent("castApiFound",{detail:{target:i.ID,available:e}});document.dispatchEvent(t),window.__gCastApiAvailable=e}}},{key:"onCastStateChanged",value:function(e){this.setAvailable(e.castState!==cast.framework.CastState.NO_DEVICES_AVAILABLE),this.dispatch(e)}},{key:"onSessionStateChanged",value:function(e){var t=this,a=null;switch(e.sessionState){case cast.framework.SessionState.SESSION_STARTING:this.player.pause(),this.player.busy=!0;break;case cast.framework.SessionState.SESSION_RESUMED:var i=this.player.media;this.player.busy=!0,this.castSession=e.session,this.resumeSession(this.castSession,i),this.player.busy=!1;break;case cast.framework.SessionState.SESSION_STARTED:this.castSession=e.session,this.castSession.addEventListener(cast.framework.SessionEventType.MEDIA_SESSION,this.onMediaSession),null==this.castSession.getMediaSession()&&this.castState===cast.framework.CastState.CONNECTING&&this.load(this.player.media,this.player.currentTime).then(function(){t.castState=cast.framework.CastState.CONNECTED});break;case cast.framework.SessionState.SESSION_ENDED:a=e.session.getMediaSession(),null!=a&&(this.player.currentTime=e.session.getMediaSession().currentTime),this.castState!==cast.framework.CastState.CONNECTING&&(this.castState=cast.framework.CastState.NOT_CONNECTED),this.player.playbackTarget="amp"}this.dispatch(e),this.setSessionState(e.sessionState)}},{key:"resumeSession",value:function(e,t){var a=this,i=e.getMediaSession(),s=function(e){var t=e.getSessionId();return a.castState===cast.framework.CastState.CONNECTING||a.session&&t==a.session.id};if(null!=t)if(null==i&&s(this.castSession)){if(this.castState!==cast.framework.CastState.CONNECTING&&!this.canResumeMedia(t,this.session.contentId))return;this.load(t,this.player.currentTime).then(function(){var e=a.castContext.getCurrentSession();i=e.getMediaSession(),a.castState=cast.framework.CastState.CONNECTED,a.session={id:a.castSession.getSessionId(),contentId:i.media.contentId},a.resumeMediaSession(i,t)})}else null!=i&&this.resumeMediaSession(i,t)}},{key:"resumeMediaSession",value:function(e,t){var a=e&&e.media?e.media.contentId:"";this.canResumeMedia(t,a)?this.onMediaSession({mediaSession:e},this.castSession.getSessionState()):this.onMediaSession({mediaSession:e})}},{key:"canResumeMedia",value:function(e,t){var a=this.selectSource(e);return a&&a.src==t}},{key:"selectSource",value:function(e){var t=Object.assign({},e),a=function(e){return null!=e},s=function(e){return i.SUPPORTED_TYPES.includes(e.type)?"maybe":""},n=function(e){return akamai.amp.Utils.selectSource(e,s)},r=u.transform([t],u.filter(a),u.filter(s)).shift();return null==r&&"source"in t&&(r=u.transform([t],u.map(n)).shift()),r}},{key:"onMediaSession",value:function(e,t){var a=cast.framework.SessionState.SESSION_RESUMED===t,s=a||this.castState===cast.framework.CastState.CONNECTING||this.loadingMedia;return s!==!0?void(this.player.busy=!1):(this.mediaSession=e.mediaSession,this.player.playbackTarget=i.ID,void this.dispatch(e))}},{key:"onplaybacktargetchange",value:function(e){e.detail.value===i.ID?this.sender=new c(this):null!=this.sender&&this.sender.destroy(),this.player.busy=!1}},{key:"launch",value:function(){var e=this;this.castState=cast.framework.CastState.CONNECTING,this.castContext.requestSession().catch(function(t){"cancel"!=t&&e.logger.error(t)})}},{key:"load",value:function e(t){var a=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(null!=t){var r=this.selectSource(t);if(null!=r){var o=Object.assign({},t,r),c=akamai.amp.Utils.getKeySystem(),l=new chrome.cast.media.MediaInfo(r.src,r.type);l.duration=o.duration,l.customData={media:o},l.metadata=s.createMetadata(o),o.keys&&o.keys.hasOwnProperty(c)&&(l.customData.licenseUrl=o.keys[c].serverURL,l.customData.keySystem=i.KEY_SYSTEM[c]);var u=o.track||[],h=function(e){return"preview"!==e.kind},m=function(e,t){return s.createTrack(t,e)},e=function(e){return l.tracks.push(e)};l.tracks=[],u.filter(h).map(m).map(e),l.textTrackStyle=s.createTextTrackStyle(this.player.settings.captions),(o.isLive||"live"===o.temporalType)&&(l.streamType=chrome.cast.media.StreamType.LIVE,l.startAbsoluteTime=Date.now());var d=new chrome.cast.media.LoadRequest(l);return d.currentTime=n||null,new Promise(function(e){a.loadingMedia=!0,a.castSession.loadMedia(d).then(function(){a.loadingMedia=!1,e()}).catch(function(e){return a.logger.error(e)})})}}}},{key:"destroy",value:function(){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"destroy",this).call(this),this.castContext&&"cast"in chrome&&(document.removeEventListener("castApiFound",this.onCastApiFound),this.castContext.removeEventListener(cast.framework.CastContextEventType.CAST_STATE_CHANGED,this.onCastStateChanged),this.castContext.removeEventListener(cast.framework.CastContextEventType.SESSION_STATE_CHANGED,this.onSessionStateChanged))}},{key:"setSessionState",value:function(e){var t=this.player.react,a=i.SENDER_STATES;for(var s in a)if(a.hasOwnProperty(s)){var n=a[s];t.container.classList.remove(n)}t.container.classList.add(a[e]),t.forceUpdate()}}]),t}(akamai.amp.Plugin);return akamai.amp.AMP.registerPlugin("chromecast",akamai.amp.Plugin.createFactory(h)),e.Chromecast=h,Object.defineProperty(e,"__esModule",{value:!0}),e}({});